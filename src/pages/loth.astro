---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <iframe 
  src="/pdfjs/web/viewer.html?file=/pdfs/Syro-Malabar-Liturgy-of-the-Hours.pdf" 
  width="100%" 
  height="800px" 
  style="border: none;">
</iframe>
      <p>
      <div id="daily-readings"></div>
      <div id="calendar-day"></div>
<b>Additional Assistance</b><br>
For a How-To Guide for using the above PDF, <a href="/blog/loth-guide">click here</a> <br>
For a list of tunes you can use when using the above PDF, <a href="/blog/loth-tunes">click here</a> <br>
For a brief look into what are the liturgies of the hours, <a href="/blog/loth">click here</a>  <br>
      </p>
<script>
function getLiturgicalDateString() {
  const date = new Date();
  if (date.getHours() >= 17) {
    date.setDate(date.getDate() + 1);
  }
  const day = String(date.getDate()).padStart(2, '0');
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const year = date.getFullYear();
  return `${day}-${month}-${year}`;
}

function getCalendarDateString() {
  const date = new Date();
  const day = String(date.getDate()).padStart(2, '0');
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const year = date.getFullYear();
  return `${day}-${month}-${year}`;
}

function renderDayInfo(data, containerId, titleLabel) {
  const set = data.Set1?.[0];
  if (!set) return;

  const day = set.DayDescription_Eng || 'Unknown Day';
  const season = set.SeasonName_Eng_Full || 'Unknown Season';
  const reading = set.Reading3_Eng || set.Reading1_Eng || 'No reading available';
  const gospel = set.ReadingGospal_Eng || 'No gospel reading available';

  const container = document.getElementById(containerId);
  if (!container) return;

  container.innerHTML = `
    <p><b>${titleLabel}</b><br>
    <b>Day:</b> ${day}<br>
    <b>Season:</b> ${season}<br>
    <b>Lelya's Epistle:</b> ${reading}<br>
    <b>Ramsa's Gospel:</b> ${gospel}<br>
    <small>(Data from <a href="https://syrocalendar.com/" target="_blank">SyroCalendar</a>)</small>
    </p>
  `;
}

function fetchDayData() {
  const liturgicalDateStr = getLiturgicalDateString();
  const calendarDateStr = getCalendarDateString();

  const liturgicalURL = `https://syrocalendar.com/SyroMalabarCalendar/?Mode=JSON&Type=DailyReadings&Date=${liturgicalDateStr}`;
  const calendarURL = `https://syrocalendar.com/SyroMalabarCalendar/?Mode=JSON&Type=DailyReadings&Date=${calendarDateStr}`;

  // Fetch both in parallel
  Promise.all([
    fetch(liturgicalURL).then(r => r.json()).catch(() => null),
    fetch(calendarURL).then(r => r.json()).catch(() => null)
  ])
  .then(([liturgicalData, calendarData]) => {
    if (liturgicalData) renderDayInfo(liturgicalData, 'liturgical-day', 'Liturgical Day Info');
    if (calendarData) renderDayInfo(calendarData, 'calendar-day', "Today's Calendar Day Info");
  })
  .catch(err => console.error('Error fetching readings:', err));
}

document.addEventListener('DOMContentLoaded', fetchDayData);
</script>
    </main>
    <Footer />
  </body>
</html>